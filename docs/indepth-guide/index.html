<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="../master.css"> -->
  <link rel="stylesheet" href="master.css">
  <title>In-depth install guide</title>
</head>

<body>

  <h1>In depth guide for installing Random Encounter Reworked</h1>

  <section class="summary">
    <blockquote>
      Please keep in mind we're in the process of updating the documentation for
      the next-gen version. While everything is rewritten, documentation for the
      older versions isn't archived yet. If you are using the 1.32 version of 
      The Witcher 3 and wish to install RER then it is recommended to wait
      a few days until the old documents are published again.
    </blockquote>

    <ul>
      <li>
        <a href="#part-1">1.</a> Downloading the mod and its dependencies, and installing it.
        <ul>
          <li><a href="#part-1-1">1.1.</a>Download the mod</li>
          <li><a href="#part-1-2">1.2.</a>Installing the mod</li>
          <li><a href="#part-1-3">1.3.</a>Updating the menu filelists</li>
        </ul>
      </li>

      <li>
        <a href="#part-2">2.</a> Merging instructions for known conflicts.
      </li>
    </ul>

    <hr />
    <ul>
      <li>
        <a href="#part-3">3.</a> <span>OPTIONAL:</span> You can also install keybinds if you want to trigger events by
        using your keyboard.
        <ul>
          <li><a href="#part-3-1">3.1.</a> Trigger an encounter</li>
          <li><a href="#part-3-2">3.2.</a> Reload the settings</li>
          <li><a href="#part-3-3">3.3.</a> Toggle RER</li>
          <li><a href="#part-3-4">3.4.</a> Analyse the surrounding ecosystem</li>
        </ul>
      </li>
    </ul>

    <hr />
    <ul>
      <li><a href="#part-4">4.</a> Uninstalling Random Encounters Reworked</li>
    </ul>
  </section>

  <section id="part-1">
    <h2>Installing the mod and its dependencies</h2>

    <div id="part-1-1">
      <h3>Downloading the mod and its dependencies</h3>
      <div>
        You can use this <a
          href="https://github.com/Aelto/tw3-random-encounters-reworked/releases/latest/download/tw3-random-encounters-reworked.zip">
          direct link
        </a> to download the latest full release archive from Github.
        Alternatively the mod is currently hosted on GitHub, and its releases are shared under
        <a href="https://github.com/Aelto/tw3-random-encounters-reworked/releases">the releases tab</a>.
        You can find the zip archive with the mod and all of its dependencies under
        the "assets" categories of the releases.
      </div>
    </div>

    <div id="part-1-2">
      <h3>Installing the mod and its dependencies</h3>
      <div>
        Navigate in the release archive until you find three folders: bin, dlc, mods;
        drop the folders in your game's root directory to merge them with the existing
        folders. When/if prompted to replace files, deny all requests to ensure
        you do not override any of your existing mods.
      </div>
    </div>

    <div id="part-1-3">
      <h3>Updating the menu filelists for next-gen</h3>
      <div>
        Two ways to do it:
        <ul>
          <li>The quick and easy way by using the menu filelist updater, from <a
              href="https://github.com/Aelto/tw3-menufilelist-updater/releases/latest">Github</a> or <a
              href="https://www.nexusmods.com/witcher3/mods/7171">Nexusmods</a></li>
          <li>Manually, by adding <span>modRandomEncountersReworked.xml</span> to the two filelists.txt files</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="part-2">
    <h2>Merging instructions</h2>
    <blockquote class="info">
      Merging instructions for known conflicts:
    </blockquote>

    <p>
      Merge everything. In case of a conflict between a sharedutils mod and a mod of yours,
      <b>always</b> pick at least the sharedutils AND the other mod. The order you pick however
      may be important so be careful on that. Sharedutils code never overrides vanilla features
      so you can be sure that by picking your other mod and sharedutils the other mod will continue
      working as intended.
    </p>

    <hr>

    <p>
      Known hard to solve conflicts:
    </p>

    <details>
      <summary>Enhanced Edition</summary>
      <blockquote>
        Since EE comes with FHUD bundled-in it is necessary you also look at the
        Friendly HUD section below.
      </blockquote>

      <div>
        <h3>Files to merge</h3>
        <div>
          All of them will merge automatically, the names of the files in the merger are blue.
        </div>
        <ul>
          <li>
            <span>engine\component.ws</span>
            <ul>
              <li>mod_sharedutils_npcInteraction</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>engine\persistentEntity.ws</span>
            <ul>
              <li>mod_sharedutils_npcInteraction</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\hud\modules\hudModuleDialog.ws</span>
            <ul>
              <li>mod_sharedutils_dialogChoices</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\hud\modules\hudModuleMinimap2.ws</span>
            <ul>
              <li>mod_sharedutils_mappins</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\menus\mapMenu.ws</span>
            <ul>
              <li>mod_sharedutils_mappins</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\player\r4Player.ws</span>
            <ul>
              <li>mod_sharedutils_mappins</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gameplay\damage\damageManagerProcessor.ws</span>
            <ul>
              <li>mod_sharedutils_damagemodifiers</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gameplay\npc\npc.ws</span>
            <ul>
              <li>mod_sharedutils_damagemodifiers</li>
              <li>modW3EE</li>
            </ul>
          </li>
        </ul>
      </div>

      <!-- <div>
        <h3>Files <b>NOT</b> to merge</h3>
        You do not need to merge these mods, however you <b>MUST</b> ensure they
        are loaded before W3EE.

        <ul>
          <li>
            <span>game\areaTypes.ws</span>
            <ul>
              <li>modBootstrap</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\hud\modules\hudModuleBossFocus.ws</span>
            <ul>
              <li>mod_sharedutils_custombossbar</li>
              <li>modW3EE</li>
            </ul>
          </li>
        </ul>
      </div> -->
    </details>

    <details>
      <summary>Friendly HUD or Enhanced Edition</summary>

      <div>
        <ul>
          <li>
            <span>playerInput.ws</span>
            <ul>
              <li>modFriendlyHUD</li>
              <li>mod_sharedutils_npcInteraction</li>
            </ul>
          </li>
        </ul>

        If a conflict between the two appears (the name of the file is in red),
        you should merge the files and wait until you are shown the conflict between
        the two given mods.

        <img src="npc_interaction_fhud_conflict.png" alt="image showing the kdiff3 between sharedutils and FHUD">
        <i>Hold left click on the image to zoom.</i>
      </div>

      <div>
        On the two top right panels you should see one panel
        for <span>sharedutils</span> and one for <span>Friendly HUD</span>. To
        confirm which panel is which mod you should read the comments in the code,
        the lines starting with <span>//</span>.
      </div>

      <div>
        Once you know which side is FHUD and which side is sharedutils, using the
        <span>B</span> and <span>C</span> letters on the top menu, you should first
        pick the sharedutils one and in second the FHUD one.
        <br>
        Refer to the screenshot to see the expected result in the bottom panel.
      </div>

      <hr>

      <div>
        <blockquote>Only if you used the FHUD patch (incompatible with W3EE)</blockquote>
        <ul>
          <li>
            <span>fhudscripts/modMarker.ws</span>
            <ul>
              <li>modFriendlyHUD</li>
              <li>mod000_sharedutilsmappinsfhudpatch</li>
            </ul>
          </li>
        </ul>

        Do no merge it, but make sure it is loaded before FHUD.
      </div>
    </details>
  </section>


  <section id="part-3">
    <h2>Adding the keyboard keybinds.</h2>
    <blockquote class="info">
      What each keybind does and how to add them to your game:
    </blockquote>

    <div id="part-3-1">
      <h3>Keybind - Trigger an encounter</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          When you press the key an encounter will be created by RER after a 5 seconds delay.
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor.</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with:
              <span>IK_0=(Action=RandomEncounter)</span>
            </li>
            <li>You can replace the <span>0</span> in <span>IK_0</span> by the key you want, here it means the
              <span>0</span> of your keyboard.
            </li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-3-2">
      <h3>Keybind - Reload the settings</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          When you change the settings you usually have to load a save for them to be applied. This keybind solves this
          by forcing a settings refresh without the need to load a save.
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor.</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with:
              <span>IK_0=(Action=OnRefreshSettings)</span>
            </li>
            <li>You can replace the <span>0</span> in <span>IK_0</span> by the key you want, here it means the
              <span>0</span> of your keyboard.
            </li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-3-3">
      <h3>Keybind - Toggle Random Encounters Reworked</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          Sometimes you want to stop RER from doing its job, you can go into the mod menu and set the
          <span>Enabled</span> toggle to OFF. This keybind can be used to toggle it without going to the mod menu.
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor.</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with:
              <span>IK_0=(Action=OnRER_enabledToggle)</span>
            </li>
            <li>You can replace the <span>0</span> in <span>IK_0</span> by the key you want, here it means the
              <span>0</span> of your keyboard.
            </li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-3-4">
      <h3>Keybind - Analyse surrounding ecosystem</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          Geralt can analyse the surrounding ecosystem to get information about the creatures that live here and also
          offers advice on how to change the ecosystem.
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor.</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with:
              <span>IK_C=(Action=EcosystemAnalyse,State=Duration,IdleTime=0.4)</span>
            </li>
            <li>You can replace the <span>C</span> in <span>IK_C</span> by the key you want, here it means the
              <span>C</span> of your keyboard.
            </li>
            <li>Note that you need to press the key for 0.4s for it to trigger.</li>
          </ol>
        </div>
      </div>
    </div>
  </section>

  <section id="part-4">
    <h2>Uninstalling Random Encounters Reworked</h2>

    <details>
      <summary><b>Before removing RER</b></summary>

      <div>
        Run the commands:
        <ul class="spaced">
          <li><span>rercompletecontract</span></li>
          <li><span>rerabandonbounty</span></li>
          <li><span>reruninstall</span></li>
        </ul>

        Then <b>save your game</b>.
      </div>
    </details>

    <details>
      <summary><b>Removing RER files</b></summary>

      <ul class="spaced">
        <li>
          In your <span>Mods</span> folder:
          <ul>
            <li>Remove all folders whose names start with <span>mod_sharedutils</span></li> (the amount of sharedutils
            mods may vary depending on the version).
            <li>Remove the <span>modRandomEncountersReworked</span> folder.</li>
          </ul>
        </li>
        <li>
          In your <span>DLC</span> folder:
          <ul>
            <li>Remove <span>dlcsharedutils</span></li>
            <li>Remove <span>dlcModRandomEncountersReworked</span></li>
          </ul>
        </li>
        <li>
          In your <span>bin/config/r4game/user_config_matrix/pc</span> folder:
          <ul>
            <li>Remove <span>modRandomEncountersReworked.xml</span></li>
          </ul>
        </li>
      </ul>
    </details>

    <details>
      <summary><b>Removing community patches and shared dependencies</b></summary>

      <div>
        The following mods are shared dependencies. RER uses them but other could
        also need them, which means you may still need them after uninstalling RER.
      </div>

      <section>
        <h3>Boostrap</h3>

        <div>
          It is sometimes needed by lightning mods, or other mods that need to
          always run in the background. Remove it if you're sure it is not needed
          anymore.
        </div>

        <ul class="spaced">
          <li>
            In your <span>Mods</span> folder:
            <ul>
              <li>Remove <span>mobBootstrap</span></li>
              <li>Remove <span>modBootstrap-registry</span></li>
            </ul>
          </li>
          <li>
            In your <span>DLC</span> folder:
            <ul>
              <li>Remove <span>dlcBootstrap</span></li>
            </ul>
          </li>
        </ul>
      </section>

      <section>
        <h3>Community Patch - Base</h3>

        <div>
          This patch is often needed by big overhauls like Ghost Mode.
        </div>

        <ul>
          <li>
            In your <span>Mods</span> folder:
            <ul>
              <li>Remove <span>mod0000___CompilationTrigger</span> if you have any (RER's installer doesn't add it)</li>
            </ul>
          </li>
        </ul>

        Then head to the <a href="https://www.nexusmods.com/witcher3/mods/3652?tab=files">Community Patch - Base</a>'s
        files
        tab, in the optional section get the vanilla scripts that correspond to your version. Refer to the
        "Uninstallation" section of this mod to understand how to restore the vanilla scripts.
      </section>

      <p>
        Once all this is done, you can finally remerge your scripts.
      </p>
    </details>
  </section>
</body>

</html>