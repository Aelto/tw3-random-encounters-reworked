<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="../master.css"> -->
  <link rel="stylesheet" href="master.css">
  <title>In-depth install guide</title>
</head>
<body>

  <h1>In depth guide for installing Random Encounter Reworked</h1>

  <section class="summary">
    <ul>
      <li>
        <a href="#part-1">1.</a> first i will explain what each dependencies does and how to install them, and in which cases you should <b>not</b> install them.
        <ul>
          <li><a href="#part-1-1">1.1.</a> modBootstrap</li>
          <li><a href="#part-1-2">1.2.</a> SharedImports</li>
          <li><a href="#part-1-3">1.3.</a> CommunityPatch - Base</li>
        </ul>
      </li>

      <li>
        <a href="#part-2">2.</a> then how to actually install Random Encounters Reworked.
      </li>

      <li>
        <a href="#part-3">3.</a> update the mod bootstrap registry and why we need to do this 
      </li>
      
      <li>
        <a href="#part-4">4.</a> install any patch for the overhauls you may use
      </li>

      <li>
        <a href="#part-5">5.</a> merging instructions for known conflicts
      </li>
    </ul>

    <hr />
    <ul>
      <li>
        <a href="#part-6">6.</a> <span>OPTIONAL:</span> you can also install keybinds if you want to trigger events by using your keyboard
        <ul>
          <li><a href="#part-6-1">6.1.</a> trigger an encounter</li>
          <li><a href="#part-6-2">6.2.</a> reload the settings</li>
          <li><a href="#part-6-3">6.3.</a> toggle RER</li>
          <li><a href="#part-6-4">6.4.</a> analyse the surrounding ecosystem</li>
        </ul>
      </li>
    </ul>
  </section>

  <section id="part-1">
    <h2>Installing the dependencies</h2>
    <blockquote class="info">
      How to install the dependencies and why Random Encounters Reworked needs them, and in which cases you could skip this step.
    </blockquote>

    <div id="part-1-1">
      <h3>Dependency - modBootstrap</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          Mod boostrap is what allows Random Encounters Reworked to start automatically as soon as you enter a game.
          Because RER is like a DLC which adds content to the game without changing anything, it needs a way to start itself. The modBootstrap solves this.
          It creates a common way for modders to inject some of their come to an invisible quest that is started on launch.
        </div>
      </div>

      <div>
        <h4>When should you skip this mod?</h4>
        <div>
          Do not install it if you have already installed it. To check if you've installed it already go into <span>The Witcher 3/mods/</span> and look for a folder named <span>modBootstrap</span>.
          If you find one then skip this step.
        </div>
      </div>

      <div>
        <h4>How to install it?</h4>
        <div>
          <ol>
            <li>Go to <a href="https://www.nexusmods.com/witcher3/mods/2109/?tab=files">modBootstrap</a>'s mod page</li>
            <li>Download <span>modBootstrap-registry</span></li>
            <li>
              Download either
              <ul>
                <li><span>modBootstrap-v0.4.1</span> if you don't have mod that change your map or the UI like "all quest objectives on map" or "E3 UI" or "Colored map markers"</li>
                <li><span>modBootstrap-v0.4.1-unmodified-worldmap</span> if you DO have such mods or are not sure (i don't have these mods but still downloaded this one and it works)</li>
              </ul>
            </li>
            <li>Drop the content of the archives you downloaded directly into <span>The Witcher 3/</span> so that you merge the archive <span>mods</span> directory with your <span>mods</span> directory</li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-1-2">
      <h3>Dependency - Shared Imports</h3>

      <div>
        <h4>What is its role</h4>
        <div>
          It's a simple mod that imports tons of helper functions (things to interact with the game) so people don't have to.
          Because if two mods import the same function the game won't start and will give you an error, hence the name "Shared" imports.
        </div>
      </div>

      <div>
        <h4>When should you skip it?</h4>
        <div>
          If you've installed it already or if you have Witcher 3 Enhanced Edition. To check if you've installed it already go into <span>The Witcher 3/mods/</span> and look for a folder named <span>modSharedImports</span>
          If you find one skip this dependency.
        </div>
      </div>

      <div>
        <h4>How to install it?</h4>
        <div>
          <ol>
            <li>Go to <a href="https://www.nexusmods.com/witcher3/mods/2110/?tab=files">Shared Imports</a>' mod page</li>
            <li>Download <span>modSharedImports-v0.6</span></li>
            <li>Drop the content of the archive you downloaded directly into <span>The Witcher 3/</span> so that you merge the archive <span>mods</span> directory with your <span>mods</span> directory</li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-1-3">
      <h3>Dependency - CommunityPatch - Base</h3>

      <div>
        <h4>What is its role</h4>
        <div>
          Not all versions have the same code and somes helper functions were added to later versions. But if RER uses one of these functions while you're not on the latest version you won't be able to use my mod.
          This mod creates a "base" (clever name eh?) for mod makers so everyone can use their mods.
        </div>
      </div>

      <div>
        <h4>When should you skip it?</h4>
        <div>
          If you've installed it already, if you have Unification Patch or if you have GM/W3EE you may not need it. To check if you've installed CP-Base already go into <span>The Witcher 3/mods/</span> and look for a folder named <span>mod0000___CompilationTrigger</span>
          If you find one skip this dependency.
        </div>
      </div>

      <div>
        <h4>How to install it?</h4>
        <div>
          <ol>
            <li>Go to <a href="https://www.nexusmods.com/witcher3/mods/3652?tab=files">CP - Base</a>'s mod page</li>
            <li>Download <span>CommunityPatch-Base</span></li>
            <li>Drop the content of the archive you downloaded directly into <span>The Witcher 3/</span> so that you merge the archive <span>mods</span> directory with your <span>mods</span> directory and also the <span>content directory</span></li>
            <li>Replace every file when prompted</li>
          </ol>
        </div>
      </div>
    </div>
  </section>

  <section id="part-2">
    <h2>Installing Random Encounters Reworked</h2>
    <blockquote class="info">
      How to actually install Random Encounters Reworked.
    </blockquote>

    <blockquote>
      As of July 2021, nexusmods is no longer used for my mods. Updates will continue to be hosted on <a href="https://github.com/Aelto/tw3-random-encounters-reworked">GitHub</a>.
      You can also see the rest of my work on <a href="https://modspot.github.io/browse/?game=witcher-3&search=user%3Aaelto">modspot</a> a
      free & ad-free alternative i'm developing
    </blockquote>

    <ol>
      <li>Go to the <a href="https://github.com/Aelto/tw3-random-encounters-reworked/releases">releases</a> on Github</li>
      <li>Download the file <span>RER_V<i>something</i></span></li>
      <li>Drop the content of the archive into your <span>The Witcher 3</span> directory so that you merge the three directories <span>mods</span>/<span>bin</span>/<span>content</span> with those already here</li>
      <li>Merge the shared utils mods from RER with the script merger of your choice. The only exception is if you use the FHUD patch, let it win by priority</li>
    </ol>
  </section>

  <section id="part-3">
    <h2>Updating the bootstrap registry</h2>
    <blockquote class="info">
      Setting up the registry so Random Encounters Reworked get started automatically
    </blockquote>

    <div>
      <h3>Why do we need this?</h3>
      <div>
        As i said in <a href="#part-1-1">part 1.1</a> the bootstrap mod allows RER to start every time you enter the game. But you have to tell him where to look for RER, this is what you do with the registry.
        It may seem complicated but it's actually the simplest solution.
      </div>
    </div>

    <div>
      <h3>How to update the registry</h3>
      <div>
        Go into <span>The Witcher 3/mods/modRandomEncountersReworked</span> and run <span>update-registry.bat</span> by double clicking it. Please always take a glance at a <span>.bat</span> file before running, by doing a right-click and edit, i know you may not be a programmer but it's a good habit and this one has comments explaining it. You never know üëç
      </div>
    </div>
  </section>
  
  <section id="part-4">
    <h2>Optional patches</h2>
    <blockquote class="info">
      Some patches may simplify your merging process, here are a few
    </blockquote>
    
    <div>
      <h3>Optional patches</h3>
      
      <div>
        <h3>Friendly HUD (not compatible with EE)</h3>
        
        <div>
          You can apply this patch to friendly HUD to see the custom markers added by RER as 3D markers.
          If the patch is used, it is simpler not to merge it with friendly HUD and let the patch win by priority. <a href="https://github.com/Aelto/tw3-random-encounters-reworked/releases/tag/dependencies-v1.0">Download it here</a>
        </div>
      </div>
      
      <div>
        <h3>Enhanced Edition</h3>
        
        <div>
          A small patch to a few sharedutils to simplify your merging process with EE.
          If the patch is used, you <b>MUST NOT</b> merge the sharedutils_bossbar utility and let it win by priority. <a href="https://github.com/Aelto/tw3-random-encounters-reworked/releases/tag/dependencies-v1.0">Download it here</a>
        </div>
      </div>
    </div>
  </section>

  <section id="part-5">
    <h2>Merging instructions</h2>
    <blockquote class="info">
      Some patches may simplify your merging process, here are a few
    </blockquote>

    <details>
      <summary>Enhanced Edition</summary>
      <blockquote>
        Since EE comes with FHUD bundled-in it is necessary you also look at the
        Friendly HUD section below.
      </blockquote>

      <div>
        <h3>Files to merge</h3>
        <div>
          All of them will merge automatically, the names of the files in the merger are blue.
        </div>
        <ul>
          <li>
            <span>engine\component.ws</span>
            <ul>
              <li>mod_sharedutils_npcInteraction</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>engine\persistentEntity.ws</span>
            <ul>
              <li>mod_sharedutils_npcInteraction</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\hud\modules\hudModuleDialog.ws</span>
            <ul>
              <li>mod_sharedutils_dialogChoices</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\hud\modules\hudModuleMinimap2.ws</span>
            <ul>
              <li>mod_sharedutils_mappins</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\menus\mapMenu.ws</span>
            <ul>
              <li>mod_sharedutils_mappins</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\player\r4Player.ws</span>
            <ul>
              <li>mod_sharedutils_mappins</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gameplay\damage\damageManagerProcessor.ws</span>
            <ul>
              <li>mod_sharedutils_damagemodifiers</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gameplay\npc\npc.ws</span>
            <ul>
              <li>mod_sharedutils_damagemodifiers</li>
              <li>modW3EE</li>
            </ul>
          </li>
        </ul>
      </div>

      <div>
        <h3>Files <b>NOT</b> to merge</h3>
        You do not need to merge these mods, however you <b>MUST</b> ensure they
        are loaded before W3EE. 

        <ul>
          <li>
            <span>game\areaTypes.ws</span>
            <ul>
              <li>modBootstrap</li>
              <li>modW3EE</li>
            </ul>
          </li>
          <li>
            <span>game\gui\hud\modules\hudModuleBossFocus.ws</span>
            <ul>
              <li>mod_sharedutils_custombossbar</li>
              <li>modW3EE</li>
            </ul>
          </li>
        </ul>
      </div>
    </details>

    <details>
      <summary>Friendly HUD</summary>

      <div>
        <ul>
          <li>
            <span>playerInput.ws</span>
            <ul>
              <li>modFriendlyHUD</li>
              <li>mod_sharedutils_npcInteraction</li>
            </ul>
          </li>
        </ul>

        If a conflict between the two appears (the name of the file is in red),
        you should merge the files and wait until you are shown the conflict between
        the two given mods.
        
        <img src="npc_interaction_fhud_conflict.png" alt="image showing the kdiff3 between sharedutils and FHUD">
        <i>hold left click on the image to zoom</i>
      </div>

      <div>
        On the two top right panels you should see one panel
        for <span>sharedutils</span> and one for <span>Friendly HUD</span>. To
        confirm which panel is which mod you should read the comments in the code,
        the lines starting with <span>//</span>.
      </div>

      <div>
        Once you know which side is FHUD and which side is sharedutils, using the
        <span>B</span> and <span>C</span> letters on the top menu, you should first
        pick the sharedutils one and in second the FHUD one.
        <br>
        Refer to the screenshot to see the expected result in the bottom panel.
      </div>

      <hr>

      <div>
        <blockquote>Only if you used the FHUD patch (incompatible with W3EE)</blockquote>
        <ul>
          <li>
            <span>fhudscripts/modMarker.ws</span>
            <ul>
              <li>modFriendlyHUD</li>
              <li>mod000_sharedutilsmappinsfhudpatch</li>
            </ul>
          </li>
        </ul>

        Do no merge it, but make sure it is loaded before FHUD.
      </div>
    </details> 
  </section>


  <section id="part-6">
    <h2>Adding the keyboard keybinds</h2>
    <blockquote class="info">
      What each keybind does and how to add them to your game
    </blockquote>

    <div id="part-6-1">
      <h3>Keybind - Trigger an encounter</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          When you press the key an encounter will be created by RER after a 5 seconds delay.
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with <span>IK_0=(Action=RandomEncounter)</span></li>
            <li>You can replace the <span>0</span> in <span>IK_0</span> by the key you want, here it means the <span>0</span> of your keyboard</li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-6-2">
      <h3>Keybind - Reload the settings</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          When you change the settings you usually have to load a save for them to be applied. This keybind solves this by forcing a settings refresh without the need to load a save.
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with <span>IK_0=(Action=OnRefreshSettings)</span></li>
            <li>You can replace the <span>0</span> in <span>IK_0</span> by the key you want, here it means the <span>0</span> of your keyboard</li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-6-3">
      <h3>Keybind - Toggle Random Encounters Reworked</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          Sometimes you want to stop RER from doing its job, you can go into the mod menu and set the <span>Enabled</span> toggle to OFF. This keybind can be used to toggle it without going to the mod menu
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with <span>IK_0=(Action=OnRER_enabledToggle)</span></li>
            <li>You can replace the <span>0</span> in <span>IK_0</span> by the key you want, here it means the <span>0</span> of your keyboard</li>
          </ol>
        </div>
      </div>
    </div>

    <div id="part-6-4">
      <h3>Keybind - Analyse surrounding ecosystem</h3>

      <div>
        <h4>What is its role?</h4>
        <div>
          Geralt can analyse the surrounding ecosystem to get information about the creatures that live here and also offers
          advice on how to change the ecosystem.
        </div>
      </div>

      <div>
        <h4>How to add it?</h4>
        <div>
          <ol>
            <li>Go to <span>Documents/The Witcher 3</span> and open <span>input.settings</span> with a text editor</li>
            <li>Search for <span>[Exploration]</span> and add a line below it with <span>IK_C=(Action=EcosystemAnalyse,State=Duration,IdleTime=0.4)</span></li>
            <li>You can replace the <span>C</span> in <span>IK_C</span> by the key you want, here it means the <span>C</span> of your keyboard</li>
            <li>Note that you need to press the key for 0.4s for it to trigger.</li>
          </ol>
        </div>
      </div>
    </div>
  </section>
</body>
</html>
